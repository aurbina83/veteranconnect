"use strict";var app;!function(t){angular.module("app",["ui.router","ngResource","ngAnimate","ngMessages","ngMaterial","ngAria","ngMaterialDatePicker","angularMoment"]).config(["$mdThemingProvider","$httpProvider","$stateProvider","$locationProvider","$urlRouterProvider",function(t,e,s,r,n){s.state("Home",{url:"/",templateUrl:"/templates/home.html",controller:"HomeController",controllerAs:"vm"}).state("Register",{url:"/register",templateUrl:"/templates/register.html",controller:"UserRegistrationController",controllerAs:"vm"}).state("Login",{url:"/login",templateUrl:"/templates/login.html",controller:"UserLoginController",controllerAs:"vm"}).state("Create Event",{url:"/create",templateUrl:"/templates/create.html",controller:"EventCreateController",controllerAs:"vm"}).state("My Events",{url:"/myevents",templateUrl:"/templates/myevents.html",controller:"MyEventController",controllerAs:"vm"}).state("Update Event",{url:"/update/:id",templateUrl:"/templates/update.html",controller:"EventUpdateController",controllerAs:"vm"}).state("Events",{url:"/events",templateUrl:"templates/events.html",controller:"EventsController",controllerAs:"vm"}).state("Event Details",{url:"/event/:id",templateUrl:"templates/event.html",controller:"EventDetailController",controllerAs:"vm"}).state("Attending",{url:"/attending",templateUrl:"/templates/attending.html",controller:"AttendingEvents",controllerAs:"vm"}).state("Welcome",{url:"/welcome",templateUrl:"/templates/welcome.html",controller:"EventsController",controllerAs:"vm"}).state("Hold",{url:"/hold",templateUrl:"/templates/hold.html",controller:"HoldingController",controllerAs:"vm"}).state("Verify",{url:"/verify",templateUrl:"/templates/verify.html"}).state("Verified",{url:"/verified",templateUrl:"/templates/verified.html",controller:"VerifiedController",controllerAs:"vm"}).state("Pending",{url:"/pending",templateUrl:"/templates/pending.html"}).state("tos",{url:"/tos",templateUrl:"templates/tos.html"}).state("privacy",{url:"/privacy",templateUrl:"templates/privacy.html"}),t.theme("default").primaryPalette("indigo").accentPalette("red"),n.otherwise("/"),r.html5Mode(!0),e.interceptors.push("AuthInterceptor")}])}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,s,r){this.EventService=t,this.$state=e,this.UserService=s,this.$http=r,this.event={title:null,name:null,description:null,numGuests:null,loc:[null],eventAddress:null,city:null,state:null,dateTime:null},this.fetch=!0,this.arr=[],this.date=new Date,this.status=s.status,s.userCheck();for(var n=2;n<99;n++)this.arr.push(n)}return t.$inject=["EventService","$state","UserService","$http"],t.prototype.rallyPoint=function(t){this.event.name=t.name,this.event.eventAddress=t.location.address,this.event.loc=[t.location.coordinate.longitude,t.location.coordinate.latitude],this.event.city=t.location.city,this.event.state=t.location.state_code},t.prototype.searchYelp=function(){var t=this;this.count=0,this.fetch=!1,this.$http.get("/api/v1/yelp/search?term="+this.term+"&location="+this.location+"&cll="+this.status.loc[1]+","+this.status.loc[0]+"&sort=0&offset="+this.count+"&limit = 20").then(function(e){t.places=e.data.businesses,t.fetch=!0},function(e){t.message=e.data.message})},t.prototype.moreYelp=function(){var t=this;this.count+=20,this.fetch=!1,this.$http.get("/api/v1/yelp/search?term="+this.term+"&location="+this.location+"&cll="+this.status.loc[1]+","+this.status.loc[0]+"&offset="+this.count+"&limit = 20").then(function(e){t.places=t.places.concat(e.data.businesses),t.fetch=!0,t.count+=20},function(e){t.message=e.data.message})},t.prototype.submit=function(){var t=this;this.EventService.createEvent(this.event).then(function(){t.$state.go("My Events")})},t}();t.EventCreateController=e,angular.module("app").controller("EventCreateController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,s,r,n){var o=this;this.EventService=t,this.UserService=e,this.CommentService=s,this.$state=r,this.$stateParams=n,this.isLoading=!0,this.attending=[],t.getOne(n.id).then(function(t){o.isLoading=!1,o.event=t,o.event.attending.map(function(t){o.attending.push(t._id)})}),this.status=e.status,e.userCheck()}return t.$inject=["EventService","UserService","CommentService","$state","$stateParams"],t.prototype.createComment=function(){var t=this;this.comment.event=this.event._id,this.CommentService.create(this.comment).then(function(e){t.event.comments.push(e),t.comment.message="",t.$state.reload()})},t}();t.EventDetailController=e,angular.module("app").controller("EventDetailController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,s,r,n){var o=this;this.EventService=t,this.$state=e,this.$stateParams=s,this.UserService=r,this.$http=n,this.arr=[],this.fetch=!0,this.date=new Date,this.status=r.status,t.getOne(s.id).then(function(t){o.event=t}),r.userCheck();for(var i=2;i<=100;i++)this.arr.push(i)}return t.$inject=["EventService","$state","$stateParams","UserService","$http"],t.prototype.rallyPoint=function(t){this.event.name=t.name,this.event.eventAddress=t.location.display_address,this.event.loc=[t.location.coordinate.longitude,t.location.coordinate.latitude],this.event.city=t.location.city,this.event.state=t.location.state_code},t.prototype.searchYelp=function(){var t=this;this.count=0,this.fetch=!1,this.$http.get("/api/v1/yelp/search?term="+this.term+"&location="+this.location+"&cll="+this.status.loc[1]+","+this.status.loc[0]+"&sort=0&offset="+this.count+"&limit = 20").then(function(e){t.result=e.data,t.result=t.result.businesses,t.places=t.result,t.fetch=!0},function(e){t.message=e.data.message})},t.prototype.moreYelp=function(){var t=this;this.count+=20,this.fetch=!1,this.$http.get("/api/v1/yelp/search?term="+this.term+"&location="+this.location+"&cll="+this.status.loc[1]+","+this.status.loc[0]+"&offset="+this.count+"&limit = 20").then(function(e){t.result=e.data,t.result=t.result.businesses;for(var s=0;s<t.result.length;s++)t.places.push(t.result[s]);t.fetch=!0,t.count+=20},function(e){t.message=e.data.message})},t.prototype.update=function(){var t=this;this.EventService.update(this.event).then(function(e){t.$state.go("My Events")})},t}();t.EventUpdateController=e,angular.module("app").controller("EventUpdateController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,s){var r=this;this.EventService=t,this.UserService=e,this.$state=s,this.isLoading=!0,this.status=e.status,e.userCheck(),t.getAttending(this.status._id).then(function(t){r.events=t,r.isLoading=!1})}return t.$inject=["EventService","UserService","$state"],t.prototype.notAttending=function(t){var e=this;this.EventService.notAttending(t._id).then(function(){e.events.splice(e.events.indexOf(t),1)})},t.prototype.go=function(t){this.$state.go("Event Details",{id:t._id})},t}();t.AttendingEvents=e,angular.module("app").controller("AttendingEvents",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,s,r,n){var o=this;this.EventService=t,this.$scope=e,this.UserService=s,this.$mdDialog=r,this.$state=n,this.fetch=!0,this.distance=15,this.status=t.status,s.userCheck(),s.status.maxDist=24,t.getAll({lng:this.status.loc[0],lat:this.status.loc[1],maxDist:this.status.maxDist}).then(function(t){o.events=t,o.fetch=!1}),e.$watch(function(){return o.status},function(e,s){o.fetch=!0,e!==s&&t.getAll({lng:o.status.loc[0],lat:o.status.loc[1],maxDist:o.status.maxDist}).then(function(t){o.events=t,o.fetch=!1})},!0)}return t.$inject=["EventService","$scope","UserService","$mdDialog","$state"],t.prototype.showAlert=function(){this.$mdDialog.show(this.$mdDialog.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("HEY YOU!").textContent("You are already in this event. Carry on.").ariaLabel("Alert Dialog Demo").ok("Got it!"))},t.prototype.setDistance=function(){this.status.maxDist=1.6*this.distance},t.prototype.attend=function(t){for(var e=this,s=0;s<t.attending.length;s++)if(t.attending[s]._id==this.status._id)return this.showAlert();this.EventService.attending(t._id).then(function(){e.$state.go("Attending")})},t.prototype.details=function(t){this.$mdDialog.show({locals:{e:t},controller:"DialogController as vm",templateUrl:"/templates/details.html",clickOutsideToClose:!0})},t}();t.EventsController=e,angular.module("app").controller("EventsController",e);var s=function(){function t(t,e){this.$mdDialog=t,this.e=e,this.event=this.e}return t.$inject=["$mdDialog","e"],t.prototype.cancel=function(){this.$mdDialog.cancel()},t}();t.DiaglogController=s,angular.module("app").controller("DialogController",s)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,s){this.UserService=t,this.$mdSidenav=e,this.$state=s,this.openLeftMenu=function(){this.$mdSidenav("left").toggle()},this.status=t.status}return t.$inject=["UserService","$mdSidenav","$state"],t}();t.GlobalController=e,angular.module("app").controller("GlobalController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,s){this.UserService=t,this.$location=e,this.$state=s,this.status=t.status,e.search().code?(t.setToken(e.search().code),t.setUser(),e.search(""),e.hash()&&e.hash(""),this.accessCheck()):s.go("Home")}return t.$inject=["UserService","$location","$state"],t.prototype.route=function(){this.status.branch||this.$state.go("Register"),this.status.branch&&!this.status.verified&&this.$state.go("Pending"),this.status.verified&&this.$state.go("Welcome")},t.prototype.accessCheck=function(){var t=this;this.UserService.getAccessCode()?this.UserService.getLocation().then(function(){t.$location.path("/verified")}):this.UserService.getLocation().then(function(){t.route()})},t}();t.HoldingController=e,angular.module("app").controller("HoldingController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,s,r){this.UserService=t,this.$state=e,this.$http=s,this.$location=r,this.status=t.status,this.status._id&&(this.status.branch&&this.status.verified&&this.$state.go("Welcome"),this.status.branch||this.$state.go("Register"),this.status.branch&&!this.status.verified&&this.$state.go("Pending"))}return t.$inject=["UserService","$state","$http","$location"],t}();t.HomeController=e,angular.module("app").controller("HomeController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t){this.error_description="bitch",this.error_description=t.error_description}return t.$inject=["$stateParams"],t}();t.IDErrorController=e,angular.module("app").controller("IDErrorController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,s){var r=this;this.UserService=t,this.EventService=e,this.$state=s,this.isLoading=!0,t.userCheck(),this.status=t.status,e.getMine(this.status._id).then(function(t){r.events=t,r.isLoading=!1})}return t.$inject=["UserService","EventService","$state"],t.prototype.removeEvent=function(t){var e=this;this.EventService.remove(t._id).then(function(){e.events.splice(e.events.indexOf(t),1)})},t.prototype.go=function(t){this.$state.go("Event Details",{id:t._id})},t}();t.MyEventController=e,angular.module("app").controller("MyEventController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,s){this.UserService=t,this.$state=e,this.$mdSidenav=s,this.openLeftMenu=function(){this.$mdSidenav("left").toggle()},this.status=t.status}return t.$inject=["UserService","$state","$mdSidenav"],t.prototype.logout=function(){this.UserService.logout(),this.$state.go("Login")},t}();t.NavController=e,angular.module("app").controller("NavController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,s){this.$stateParams=t,this.UserService=e,this.$state=s,t.accessToken&&(e.setTroop(t.accessToken),e.verify(t.accessToken))}return t.$inject=["$stateParams","UserService","$state"],t}();t.TroopID=e,angular.module("app").controller("TroopID",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e){this.UserService=t,this.$state=e,this.status=t.status,this.status._id&&this.$state.go("Home")}return t.$inject=["UserService","$state"],t}();t.UserLoginController=e,angular.module("app").controller("UserLoginController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,s){this.UserService=t,this.$state=e,this.$location=s,this.branches=["Army","Navy","Marines","Air Force"],this.email=/^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.(aero|arpa|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro|travel|mobi|[a-z][a-z])|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i,this.password=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[$@$!%*?&])[A-Za-z\d$@$!%*?&]{8,}/,this.status=t.status}return t.$inject=["UserService","$state","$location"],t.prototype.setMos=function(){"Army"==this.user.branch&&(this.mos="MOS",this.max=3,this.pattern=/^[a-zA-Z0-9]+$/,this.patternMessage="Two numbers and one letter only. No AKIs or SQIs",this.user.branchImg="images/army.png"),"Marines"==this.user.branch&&(this.mos="MOS",this.max=4,this.pattern=/^[0-9]+$/,this.patternMessage="Four numbers only. No other identifiers please.",this.user.branchImg="images/marines.png"),"Air Force"==this.user.branch&&(this.mos="AFSC",this.max=5,this.pattern=/^[a-zA-Z0-9]+$/,this.patternMessage="Numbers and letters only",this.user.branchImg="images/airforce.png"),"Navy"==this.user.branch&&(this.mos="GENERAL & SERVICE RATING ABBREVIATION",this.max=3,this.pattern=/^[a-zA-Z]+$/,this.patternMessage="Max of 3 letters please. No rank or other identifiers please.",this.user.branchImg="images/navy.png")},t.prototype.register=function(t,e,s,r){var n=this;this.user.email=this.user.email.toLowerCase().trim(),this.user.mos=this.user.mos.toUpperCase(),this.UserService.register(this.status._id,{email:this.user.email,branch:this.user.branch,mos:this.user.mos,branchImg:this.user.branchImg}).then(function(){n.$state.go("Verify")})},t}();t.UserRegistrationController=e,angular.module("app").controller("UserRegistrationController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,s,r,n){this.$location=t,this.UserService=e,this.$http=s,this.$q=r,this.$state=n,this.status=e.status,t.search().access_code?(this.access_code=t.search().access_code,t.search(""),t.hash()&&t.hash(""),this.loginCheck()):e.getAccessCode()&&(this.access_code=e.getAccessCode(),this.updateUser(),e.removeAccessCode())}return t.$inject=["$location","UserService","$http","$q","$state"],t.prototype.updateUser=function(){var t=this;this.$http.delete("/api/v1/access/"+this.access_code).then(function(e){t.UserService.setToken(e.data.token),t.UserService.setUser(),t.$state.go("Welcome")},function(e){t.message=e.data.message})},t.prototype.loginCheck=function(){this.UserService.getToken()?this.updateUser():(this.UserService.setAccessCode(this.access_code),this.$state.go("Login"))},t}();t.VerifiedController=e,angular.module("app").controller("VerifiedController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={})),angular.module("infiniteScroll",[]).directive("infiniteScroll",["$window",function(t){return{link:function(t,e,s){var r=parseInt(s.threshold)||0,n=e[0];e.bind("scroll",function(){t.$eval(s.canLoad)&&n.scrollTop+n.offsetHeight>=n.scrollHeight-r&&t.$apply(s.infiniteScroll)})}}}]),angular.module("app").directive("navbar",function(){return{templateUrl:"../../templates/nav.html",restrict:"E",controller:"NavController",controllerAs:"nav"}});var app;!function(t){var e;!function(t){angular.module("app").filter("url",function(){return function(t,e){return t.substr(0,e-6)+"ls.jpg"}})}(e=t.Filters||(t.Filters={}))}(app||(app={}));var app;!function(t){var e;!function(t){angular.module("app").filter("truncate",function(){return function(t,e){return t.length<=e?t:t.substr(0,e-3)+"..."}})}(e=t.Filters||(t.Filters={}))}(app||(app={}));var app;!function(t){var e;!function(t){function e(t){return{request:function(e){return e.headers=e.headers||{},t.localStorage.getItem("token")&&(e.headers.Authorization="Bearer "+t.localStorage.getItem("token")),e}}}e.$inject=["$window"],t.AuthInterceptor=e,angular.module("app").service("AuthInterceptor",e)}(e=t.Services||(t.Services={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,s){this.$resource=t,this.$http=e,this.$q=s,this.CommentResource=t("/api/v1/comments/:id",null,{update:{method:"PUT"}})}return t.$inject=["$resource","$http","$q"],t.prototype.create=function(t){return this.CommentResource.save(t).$promise},t.prototype.remove=function(t){return this.CommentResource.remove({id:t}).$promise},t.prototype.update=function(t){return this.CommentResource.update({id:t._id},{message:t.message}).$promise},t}();t.CommentService=e,angular.module("app").service("CommentService",e)}(e=t.Services||(t.Services={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,s,r){this.$resource=t,this.$http=e,this.$q=s,this.UserService=r,this.EventResource=t("/api/v1/events/:id",null,{update:{method:"PUT"}}),this.status=r.status}return t.$inject=["$resource","$http","$q","UserService"],t.prototype.getAll=function(t){var e=t.lng,s=t.lat,r=t.maxDist;return this.EventResource.query({lng:e,lat:s,maxDist:r}).$promise},t.prototype.getOne=function(t){return this.EventResource.get({id:t}).$promise},t.prototype.getMine=function(t){return this.EventResource.query({id:"myevents"}).$promise},t.prototype.getAttending=function(t){return this.EventResource.query({id:"attending"}).$promise},t.prototype.createEvent=function(t){return this.EventResource.save(t).$promise},t.prototype.update=function(t){return this.EventResource.update({id:t._id},{title:t.title,description:t.description,numGuests:t.numGuests,loc:t.loc,eventAddress:t.eventAddress,dateTime:t.dateTime,name:t.name,city:t.city,state:t.state}).$promise},t.prototype.attending=function(t){var e=this.$q.defer();return this.$http.put("/api/v1/events/attending/"+t,null).then(function(){e.resolve()}),e.promise},t.prototype.notAttending=function(t){var e=this.$q.defer();return this.$http.put("/api/v1/events/notattending/"+t,null).then(function(){e.resolve()}),e.promise},t.prototype.remove=function(t){return this.EventResource.remove({id:t}).$promise},t}();t.EventService=e,angular.module("app").service("EventService",e)}(e=t.Services||(t.Services={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,s,r,n){this.$http=t,this.$q=e,this.$window=s,this.$timeout=r,this.$state=n,this.status={_id:null,name:null,imgUrl:null,maxDist:null,loc:null,verified:null,branch:null},this.getToken()&&(null==this.getToken()?(this.logout(),console.log("fuck")):(this.setUser(),this.getLocation()))}return t.$inject=["$http","$q","$window","$timeout","$state"],t.prototype.login=function(t){var e=this,s=this.$q.defer();return this.$http.post("/api/v1/users/login",t).then(function(t){e.setToken(t.data.token),e.setUser(),s.resolve()}),s.promise},t.prototype.register=function(t,e){var s=this,r=e.email,n=e.branch,o=e.mos,i=e.branchImg,a=this.$q.defer();return this.$http.put("/api/v1/users/register/"+t,{email:r,branch:n,mos:o,branchImg:i}).then(function(t){s.setToken(t.data.token),s.setUser(),a.resolve()}),a.promise},t.prototype.getToken=function(){return this.$window.localStorage.getItem("token")},t.prototype.setToken=function(t){this.$window.localStorage.setItem("token",t)},t.prototype.logout=function(){this.$window.localStorage.removeItem("token"),this.clearUser()},t.prototype.getAccessCode=function(){return this.$window.localStorage.getItem("access_code")},t.prototype.setAccessCode=function(t){this.$window.localStorage.setItem("access_code",t)},t.prototype.removeAccessCode=function(){this.$window.localStorage.removeItem("access_code")},t.prototype.setUser=function(){var t=(this.getToken(),JSON.parse(this.urlBase64Decode(this.getToken().split(".")[1])));this.status._id=t._id,this.status.name=t.firstName+" "+t.lastName,this.status.imgUrl=t.imgUrl,this.status.branch=t.branch,this.status.verified=t.verified,t.loc&&(this.status.loc=t.loc)},t.prototype.updateLoc=function(t,e){var s=this,r=e.loc,n=this.$q.defer();return this.$http.put("/api/v1/users/location/"+t,{loc:r}).then(function(t){s.setToken(t.data.token),s.setUser(),n.resolve()}),n.promise},t.prototype.getLocation=function(){var t=this,e=this.$q.defer();return navigator.geolocation.getCurrentPosition(function(s){var r=s.coords.latitude,n=s.coords.longitude,o=[n,r];t.status.loc=o,t.updateLoc(t.status._id,{loc:o}),e.resolve()}),e.promise},t.prototype.clearUser=function(){this.status._id=null,this.status.name=null,this.status.maxDist=null,this.status.imgUrl=null,this.status.branch=null,this.status.loc=null,this.status.verified=null},t.prototype.urlBase64Decode=function(t){var e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}return decodeURIComponent(encodeURIComponent(this.$window.atob(e)))},t.prototype.userCheck=function(){this.getToken()||this.$state.go("Login"),this.getToken()&&!this.status.branch&&this.$state.go("Register"),this.getToken()&&!this.status.verified&&this.$state.go("Pending")},t}();t.UserService=e,angular.module("app").service("UserService",e)}(e=t.Services||(t.Services={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e){this.$http=t,this.$q=e}return t.$inject=["$http","$q"],t.prototype.yelpSearch=function(t){var e=(t.term,t.location,this.$q.defer());return e.promise},t}();t.YelpService=e,angular.module("app").service("YelpService",e)}(e=t.Services||(t.Services={}))}(app||(app={}));