"use strict";var app;!function(t){angular.module("app",["ui.router","ngResource","ngAnimate","ngMessages","ngMaterial","ngAria","ngMaterialDatePicker","ngSanitize","angularMoment","oitozero.ngSweetAlert"]).config(["$mdThemingProvider","$httpProvider","$stateProvider","$locationProvider","$urlRouterProvider",function(t,e,r,n,s){r.state("Home",{url:"/",templateUrl:"/templates/home.html",controller:"HomeController",controllerAs:"vm"}).state("Register",{url:"/register",templateUrl:"/templates/register.html",controller:"UserRegistrationController",controllerAs:"vm"}).state("Login",{url:"/login",templateUrl:"/templates/login.html",controller:"UserLoginController",controllerAs:"vm"}).state("Create Event",{url:"/create",templateUrl:"/templates/create.html",controller:"EventCreateController",controllerAs:"vm"}).state("My Events",{url:"/myevents",templateUrl:"/templates/myevents.html",controller:"MyEventController",controllerAs:"vm"}).state("Update Event",{url:"/update/:id",templateUrl:"/templates/update.html",controller:"EventUpdateController",controllerAs:"vm"}).state("Events",{url:"/events",templateUrl:"templates/events.html",controller:"EventsController",controllerAs:"vm"}).state("Event Details",{url:"/event/:id",templateUrl:"templates/event.html",controller:"EventDetailController",controllerAs:"vm"}).state("Attending",{url:"/attending",templateUrl:"/templates/attending.html",controller:"AttendingEvents",controllerAs:"vm"}).state("Welcome",{url:"/welcome",templateUrl:"/templates/welcome.html",controller:"WelcomeController",controllerAs:"vm"}).state("Hold",{url:"/hold",templateUrl:"/templates/hold.html",controller:"HoldingController",controllerAs:"vm"}).state("Verify",{url:"/verify",templateUrl:"/templates/verify.html"}).state("Verified",{url:"/verified",templateUrl:"/templates/verified.html",controller:"VerifiedController",controllerAs:"vm"}).state("Pending",{url:"/pending",templateUrl:"/templates/pending.html"}).state("tos",{url:"/tos",templateUrl:"templates/tos.html"}).state("privacy",{url:"/privacy",templateUrl:"templates/privacy.html"}),t.theme("success").primaryPalette("green"),t.theme("warning").primaryPalette("red"),s.otherwise("/"),n.html5Mode(!0),e.interceptors.push("AuthInterceptor")}])}(app||(app={})),angular.module("infiniteScroll",[]).directive("infiniteScroll",["$window",function(t){return{link:function(t,e,r){var n=parseInt(r.threshold)||0,s=e[0];e.bind("scroll",function(){t.$eval(r.canLoad)&&s.scrollTop+s.offsetHeight>=s.scrollHeight-n&&t.$apply(r.infiniteScroll)})}}}]),angular.module("app").directive("navbar",function(){return{templateUrl:"../../templates/nav.html",restrict:"E",controller:"NavController",controllerAs:"nav"}});var app;!function(t){var e;!function(t){angular.module("app").filter("url",function(){return function(t,e){return t.substr(0,e-6)+"ls.jpg"}})}(e=t.Filters||(t.Filters={}))}(app||(app={}));var app;!function(t){var e;!function(t){angular.module("app").filter("truncate",function(){return function(t,e){return t.length<=e?t:t.substr(0,e-3)+"..."}})}(e=t.Filters||(t.Filters={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,r,n,s){this.EventService=t,this.$state=e,this.UserService=r,this.$http=n,this.ErrorService=s,this.event={title:null,name:null,description:null,numGuests:null,loc:[null],eventAddress:null,city:null,state:null,dateTime:null},this.fetch=!0,this.arr=[],this.date=new Date,this.status=r.status,r.userCheck();for(var o=2;o<99;o++)this.arr.push(o)}return t.$inject=["EventService","$state","UserService","$http","ErrorService"],t.prototype.rallyPoint=function(t){this.event.name=t.name,this.event.eventAddress=t.location.address,this.event.loc=[t.location.coordinate.longitude,t.location.coordinate.latitude],this.event.city=t.location.city,this.event.state=t.location.state_code},t.prototype.searchYelp=function(){var t=this;this.count=0,this.fetch=!1,this.$http.get("/api/v1/yelp/search?term="+this.term+"&location="+this.location+"&cll="+this.status.loc[1]+","+this.status.loc[0]+"&sort=0&offset="+this.count+"&limit = 20").then(function(e){t.places=e.data.businesses,t.fetch=!0},function(e){t.ErrorService.sweetAlert("Damn!",e.data.message,"warning")})},t.prototype.moreYelp=function(){var t=this;this.count+=20,this.fetch=!1,this.$http.get("/api/v1/yelp/search?term="+this.term+"&location="+this.location+"&cll="+this.status.loc[1]+","+this.status.loc[0]+"&offset="+this.count+"&limit = 20").then(function(e){t.places=t.places.concat(e.data.businesses),t.fetch=!0,t.count+=20},function(e){t.ErrorService.sweetAlert("Damn!!",e.data.message,"warning")})},t.prototype.submit=function(){var t=this;this.EventService.createEvent(this.event).then(function(e){t.ErrorService.toast("Event Created!","success"),t.$state.go("My Events")},function(e){t.ErrorService.sweetAlert("Oops, something went wrong!",e.data.message,"warning")})},t}();t.EventCreateController=e,angular.module("app").controller("EventCreateController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,r,n,s,o){var i=this;this.EventService=t,this.ErrorService=e,this.UserService=r,this.CommentService=n,this.$state=s,this.$stateParams=o,this.isLoading=!0,this.attending=[],t.getOne(o.id).then(function(t){i.isLoading=!1,i.event=t,i.event.attending.map(function(t){i.attending.push(t._id)})},function(t){e.toast(t.data.message,"warning")}),this.status=r.status,r.userCheck()}return t.$inject=["EventService","ErrorService","UserService","CommentService","$state","$stateParams"],t.prototype.createComment=function(){var t=this;this.comment.event=this.event._id,this.CommentService.create(this.comment).then(function(e){t.event.comments.push(e),t.comment.message="",t.$state.reload()},function(e){t.ErrorService.toast(e.data.message,"warning")})},t}();t.EventDetailController=e,angular.module("app").controller("EventDetailController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,r,n,s,o){var i=this;this.EventService=t,this.$state=e,this.$stateParams=r,this.UserService=n,this.$http=s,this.ErrorService=o,this.arr=[],this.fetch=!0,this.date=new Date,this.status=n.status,t.getOne(r.id).then(function(t){i.event=t},function(t){o.toast(t.data.message,"warning")}),n.userCheck();for(var a=2;a<=100;a++)this.arr.push(a)}return t.$inject=["EventService","$state","$stateParams","UserService","$http","ErrorService"],t.prototype.rallyPoint=function(t){this.event.name=t.name,this.event.eventAddress=t.location.display_address,this.event.loc=[t.location.coordinate.longitude,t.location.coordinate.latitude],this.event.city=t.location.city,this.event.state=t.location.state_code},t.prototype.searchYelp=function(){var t=this;this.count=0,this.fetch=!1,this.$http.get("/api/v1/yelp/search?term="+this.term+"&location="+this.location+"&cll="+this.status.loc[1]+","+this.status.loc[0]+"&sort=0&offset="+this.count+"&limit = 20").then(function(e){t.places=e.data.businesses,t.fetch=!0},function(e){t.ErrorService.sweetAlert("Damn!",e.data.message,"warning")})},t.prototype.moreYelp=function(){var t=this;this.count+=20,this.fetch=!1,this.$http.get("/api/v1/yelp/search?term="+this.term+"&location="+this.location+"&cll="+this.status.loc[1]+","+this.status.loc[0]+"&offset="+this.count+"&limit = 20").then(function(e){t.places=t.places.concat(e.data.businesses),t.fetch=!0,t.count+=20},function(e){t.ErrorService.sweetAlert("Damn!!",e.data.message,"warning")})},t.prototype.update=function(){var t=this;this.EventService.update(this.event).then(function(e){t.ErrorService.toast("Event Updated!","success"),t.$state.go("My Events")},function(e){t.ErrorService.toast(e.data.message,"warning")})},t}();t.EventUpdateController=e,angular.module("app").controller("EventUpdateController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,r,n){var s=this;this.EventService=t,this.UserService=e,this.$state=r,this.ErrorService=n,this.isLoading=!0,this.status=e.status,e.userCheck(),t.getAttending(this.status._id).then(function(t){s.events=t,s.isLoading=!1},function(t){n.toast(t.data.message,"warning")})}return t.$inject=["EventService","UserService","$state","ErrorService"],t.prototype.notAttending=function(t){var e=this;this.EventService.notAttending(t._id).then(function(r){e.ErrorService.toast("You're Out!","success"),e.events.splice(e.events.indexOf(t),1)},function(t){e.ErrorService.toast(t.data.message,"warning")})},t.prototype.go=function(t){this.$state.go("Event Details",{id:t._id})},t}();t.AttendingEvents=e,angular.module("app").controller("AttendingEvents",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,r,n,s,o){var i=this;this.EventService=t,this.$scope=e,this.UserService=r,this.$mdDialog=n,this.$state=s,this.ErrorService=o,this.fetch=!0,this.distance=15,this.status=t.status,r.userCheck(),r.status.maxDist=24,t.getAll({lng:this.status.loc[0],lat:this.status.loc[1],maxDist:this.status.maxDist}).then(function(t){i.events=t,0==i.events.length&&o.sweetAlertRoute("DRY HOLE","Looks like there aren't any events in your AO...so go create one!!.","Create Event"),i.fetch=!1},function(t){o.sweetAlert("Error","Sorry, we're all ate up right now. Try reloading the page or checking back later.","error")}),e.$watch(function(){return i.status},function(e,r){i.fetch=!0,e!==r&&t.getAll({lng:i.status.loc[0],lat:i.status.loc[1],maxDist:i.status.maxDist}).then(function(t){i.events=t,i.fetch=!1},function(t){o.sweetAlert("Error","Sorry, we're all ate up right now. Try reloading the page or checking back later.","error")})},!0)}return t.$inject=["EventService","$scope","UserService","$mdDialog","$state","ErrorService"],t.prototype.showAlert=function(){this.ErrorService.sweetAlert("Slow down there, High Speed!","You'e already in this event. Pop smoke","warning")},t.prototype.setDistance=function(){this.status.maxDist=1.6*this.distance},t.prototype.attend=function(t){for(var e=this,r=0;r<t.attending.length;r++)if(t.attending[r]._id==this.status._id)return this.showAlert();this.EventService.attending(t._id).then(function(){e.ErrorService.toast("You're in!","success"),e.$state.go("Attending")},function(t){e.ErrorService.sweetAlertReload("Draggin ass!",t.data.message)})},t.prototype.details=function(t){this.$mdDialog.show({locals:{e:t},controller:"DialogController as vm",templateUrl:"/templates/details.html",clickOutsideToClose:!0})},t}();t.EventsController=e,angular.module("app").controller("EventsController",e);var r=function(){function t(t,e){this.$mdDialog=t,this.e=e,this.event=this.e}return t.$inject=["$mdDialog","e"],t.prototype.cancel=function(){this.$mdDialog.cancel()},t}();t.DiaglogController=r,angular.module("app").controller("DialogController",r)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,r){this.UserService=t,this.$mdSidenav=e,this.$state=r,this.openLeftMenu=function(){this.$mdSidenav("left").toggle()},this.status=t.status}return t.$inject=["UserService","$mdSidenav","$state"],t}();t.GlobalController=e,angular.module("app").controller("GlobalController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,r){this.UserService=t,this.$location=e,this.$state=r,this.status=t.status,e.search().code?(t.setToken(e.search().code),t.setUser(),e.search(""),e.hash()&&e.hash(""),this.accessCheck()):r.go("Home")}return t.$inject=["UserService","$location","$state"],t.prototype.route=function(){this.status.branch||this.$state.go("Register"),this.status.branch&&!this.status.verified&&this.$state.go("Pending"),this.status.verified&&this.$state.go("Welcome")},t.prototype.accessCheck=function(){var t=this;this.UserService.getAccessCode()?this.UserService.getLocation().then(function(){t.$location.path("/verified")}):this.UserService.getLocation().then(function(){t.route()})},t}();t.HoldingController=e,angular.module("app").controller("HoldingController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,r,n){this.UserService=t,this.$state=e,this.$http=r,this.$location=n,this.status=t.status,this.status._id&&(this.status.branch&&this.status.verified&&this.$state.go("Welcome"),this.status.branch||this.$state.go("Register"),this.status.branch&&!this.status.verified&&this.$state.go("Pending"))}return t.$inject=["UserService","$state","$http","$location"],t}();t.HomeController=e,angular.module("app").controller("HomeController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t){this.error_description="bitch",this.error_description=t.error_description}return t.$inject=["$stateParams"],t}();t.IDErrorController=e,angular.module("app").controller("IDErrorController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,r,n){var s=this;this.UserService=t,this.EventService=e,this.$state=r,this.ErrorService=n,this.isLoading=!0,t.userCheck(),this.status=t.status,e.getMine(this.status._id).then(function(t){s.events=t,s.isLoading=!1},function(t){s.ErrorService.toast(t.data.message,"warning")})}return t.$inject=["UserService","EventService","$state","ErrorService"],t.prototype.removeEvent=function(t){var e=this;this.EventService.remove(t._id).then(function(r){e.ErrorService.toast("Event Deleted","success"),e.events.splice(e.events.indexOf(t),1)},function(t){e.ErrorService.toast(t.data.message,"warning")})},t.prototype.go=function(t){this.$state.go("Event Details",{id:t._id})},t}();t.MyEventController=e,angular.module("app").controller("MyEventController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,r){this.UserService=t,this.$state=e,this.$mdSidenav=r,this.openLeftMenu=function(){this.$mdSidenav("left").toggle()},this.status=t.status}return t.$inject=["UserService","$state","$mdSidenav"],t.prototype.logout=function(){this.UserService.logout(),this.$state.go("Login")},t}();t.NavController=e,angular.module("app").controller("NavController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,r){this.$stateParams=t,this.UserService=e,this.$state=r,t.accessToken&&(e.setTroop(t.accessToken),e.verify(t.accessToken))}return t.$inject=["$stateParams","UserService","$state"],t}();t.TroopID=e,angular.module("app").controller("TroopID",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e){this.UserService=t,this.$state=e,this.status=t.status,this.status._id&&this.$state.go("Home")}return t.$inject=["UserService","$state"],t}();t.UserLoginController=e,angular.module("app").controller("UserLoginController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,r){this.UserService=t,this.$state=e,this.$location=r,this.branches=["Army","Navy","Marines","Air Force"],this.email=/^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.(aero|arpa|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro|travel|mobi|[a-z][a-z])|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i,this.password=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[$@$!%*?&])[A-Za-z\d$@$!%*?&]{8,}/,this.status=t.status}return t.$inject=["UserService","$state","$location"],t.prototype.setMos=function(){"Army"==this.user.branch&&(this.mos="MOS",this.max=3,this.pattern=/^[a-zA-Z0-9]+$/,this.patternMessage="Two numbers and one letter only. No AKIs or SQIs",this.user.branchImg="images/army.png"),"Marines"==this.user.branch&&(this.mos="MOS",this.max=4,this.pattern=/^[0-9]+$/,this.patternMessage="Four numbers only. No other identifiers please.",this.user.branchImg="images/marines.png"),"Air Force"==this.user.branch&&(this.mos="AFSC",this.max=5,this.pattern=/^[a-zA-Z0-9]+$/,this.patternMessage="Numbers and letters only",this.user.branchImg="images/airforce.png"),"Navy"==this.user.branch&&(this.mos="GENERAL & SERVICE RATING ABBREVIATION",this.max=3,this.pattern=/^[a-zA-Z]+$/,this.patternMessage="Max of 3 letters please. No rank or other identifiers please.",this.user.branchImg="images/navy.png")},t.prototype.register=function(t,e,r,n){var s=this;this.user.email=this.user.email.toLowerCase().trim(),this.user.mos=this.user.mos.toUpperCase(),this.UserService.register(this.status._id,{email:this.user.email,branch:this.user.branch,mos:this.user.mos,branchImg:this.user.branchImg}).then(function(){s.$state.go("Verify")})},t}();t.UserRegistrationController=e,angular.module("app").controller("UserRegistrationController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,r,n,s,o){this.ErrorService=t,this.$location=e,this.UserService=r,this.$http=n,this.$q=s,this.$state=o,this.status=r.status,e.search().access_code?(this.access_code=e.search().access_code,e.search(""),e.hash()&&e.hash(""),this.loginCheck()):r.getAccessCode()&&(this.access_code=r.getAccessCode(),this.updateUser(),r.removeAccessCode())}return t.$inject=["ErrorService","$location","UserService","$http","$q","$state"],t.prototype.updateUser=function(){var t=this;this.$http.delete("/api/v1/access/"+this.access_code).then(function(e){t.UserService.setToken(e.data.token),t.UserService.setUser(),t.$state.go("Welcome")},function(e){t.ErrorService.sweetAlertRoute(e.data.message,"You may need to re-verify your service. Come back when you find my box of reticles.","Verify")})},t.prototype.loginCheck=function(){this.UserService.getToken()?this.updateUser():(this.UserService.setAccessCode(this.access_code),this.$state.go("Login"))},t}();t.VerifiedController=e,angular.module("app").controller("VerifiedController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t){this.UserService=t,t.userCheck()}return t.$inject=["UserService"],t}();t.WelcomeController=e,angular.module("app").controller("WelcomeController",e)}(e=t.Controllers||(t.Controllers={}))}(app||(app={}));var app;!function(t){var e;!function(t){function e(t){return{request:function(e){return e.headers=e.headers||{},t.localStorage.getItem("token")&&(e.headers.Authorization="Bearer "+t.localStorage.getItem("token")),e}}}e.$inject=["$window"],t.AuthInterceptor=e,angular.module("app").service("AuthInterceptor",e)}(e=t.Services||(t.Services={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,r){this.$resource=t,this.$http=e,this.$q=r,this.CommentResource=t("/api/v1/comments/:id",null,{update:{method:"PUT"}})}return t.$inject=["$resource","$http","$q"],t.prototype.create=function(t){return this.CommentResource.save(t).$promise},t.prototype.remove=function(t){return this.CommentResource.remove({id:t}).$promise},t.prototype.update=function(t){return this.CommentResource.update({id:t._id},{message:t.message}).$promise},t}();t.CommentService=e,angular.module("app").service("CommentService",e)}(e=t.Services||(t.Services={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,r){this.SweetAlert=t,this.$mdToast=e,this.$state=r}return t.$inject=["SweetAlert","$mdToast","$state"],t.prototype.toast=function(t,e){this.$mdToast.show(this.$mdToast.simple().textContent(t).position("bottom right").hideDelay(3e3).theme(e))},t.prototype.sweetAlert=function(t,e,r){this.SweetAlert.swal(t,e,r)},t.prototype.sweetAlertReload=function(t,e){var r=this;this.SweetAlert.swal({title:t,text:e,type:null,allowOutsideClick:!0,showCancelButton:!1,confirmButtonColor:"#B5191D",confirmButtonText:"Ok!",closeOnConfirm:!0},function(){r.$state.reload()})},t.prototype.sweetAlertRoute=function(t,e,r){var n=this;this.SweetAlert.swal({title:t,text:e,type:"warning",allowOutsideClick:!0,showCancelButton:!1,confirmButtonColor:"#B5191D",confirmButtonText:"Ok!",closeOnConfirm:!0},function(){n.$state.go(r)})},t}();t.ErrorService=e,angular.module("app").service("ErrorService",e)}(e=t.Services||(t.Services={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,r,n){this.$resource=t,this.$http=e,this.$q=r,this.UserService=n,this.EventResource=t("/api/v1/events/:id",null,{update:{method:"PUT"}}),this.status=n.status}return t.$inject=["$resource","$http","$q","UserService"],t.prototype.getAll=function(t){var e=t.lng,r=t.lat,n=t.maxDist;return this.EventResource.query({lng:e,lat:r,maxDist:n}).$promise},t.prototype.getOne=function(t){return this.EventResource.get({id:t}).$promise},t.prototype.getMine=function(t){return this.EventResource.query({id:"myevents"}).$promise},t.prototype.getAttending=function(t){return this.EventResource.query({id:"attending"}).$promise},t.prototype.createEvent=function(t){return this.EventResource.save(t).$promise},t.prototype.update=function(t){return this.EventResource.update({id:t._id},{title:t.title,description:t.description,numGuests:t.numGuests,loc:t.loc,eventAddress:t.eventAddress,dateTime:t.dateTime,name:t.name,city:t.city,state:t.state}).$promise},t.prototype.attending=function(t){var e=this.$q.defer();return this.$http.put("/api/v1/events/attending/"+t,null).then(function(){e.resolve()},function(t){e.reject(t)}),e.promise},t.prototype.notAttending=function(t){var e=this.$q.defer();return this.$http.put("/api/v1/events/notattending/"+t,null).then(function(){e.resolve()}),e.promise},t.prototype.remove=function(t){return this.EventResource.remove({id:t}).$promise},t}();t.EventService=e,angular.module("app").service("EventService",e)}(e=t.Services||(t.Services={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e,r,n,s){this.$http=t,this.$q=e,this.$window=r,this.$timeout=n,this.$state=s,this.status={_id:null,name:null,imgUrl:null,maxDist:null,loc:null,verified:null,branch:null},this.getToken()&&(null==this.getToken()?(this.logout(),console.log("fuck")):(this.setUser(),this.getLocation()))}return t.$inject=["$http","$q","$window","$timeout","$state"],t.prototype.login=function(t){var e=this,r=this.$q.defer();return this.$http.post("/api/v1/users/login",t).then(function(t){e.setToken(t.data.token),e.setUser(),r.resolve()}),r.promise},t.prototype.register=function(t,e){var r=this,n=e.email,s=e.branch,o=e.mos,i=e.branchImg,a=this.$q.defer();return this.$http.put("/api/v1/users/register/"+t,{email:n,branch:s,mos:o,branchImg:i}).then(function(t){r.setToken(t.data.token),r.setUser(),a.resolve()}),a.promise},t.prototype.getToken=function(){return this.$window.localStorage.getItem("token")},t.prototype.setToken=function(t){this.$window.localStorage.setItem("token",t)},t.prototype.logout=function(){this.$window.localStorage.removeItem("token"),this.clearUser()},t.prototype.getAccessCode=function(){return this.$window.localStorage.getItem("access_code")},t.prototype.setAccessCode=function(t){this.$window.localStorage.setItem("access_code",t)},t.prototype.removeAccessCode=function(){this.$window.localStorage.removeItem("access_code")},t.prototype.setUser=function(){var t=(this.getToken(),JSON.parse(this.urlBase64Decode(this.getToken().split(".")[1])));this.status._id=t._id,this.status.name=t.firstName+" "+t.lastName,this.status.imgUrl=t.imgUrl,this.status.branch=t.branch,this.status.verified=t.verified,t.loc&&(this.status.loc=t.loc)},t.prototype.updateLoc=function(t,e){var r=this,n=e.loc,s=this.$q.defer();return this.$http.put("/api/v1/users/location/"+t,{loc:n}).then(function(t){r.setToken(t.data.token),r.setUser(),s.resolve()}),s.promise},t.prototype.getLocation=function(){var t=this,e=this.$q.defer();return navigator.geolocation.getCurrentPosition(function(r){var n=r.coords.latitude,s=r.coords.longitude,o=[s,n];t.status.loc=o,t.updateLoc(t.status._id,{loc:o}),e.resolve()}),e.promise},t.prototype.clearUser=function(){this.status._id=null,this.status.name=null,this.status.maxDist=null,this.status.imgUrl=null,this.status.branch=null,this.status.loc=null,this.status.verified=null},t.prototype.urlBase64Decode=function(t){var e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}return decodeURIComponent(encodeURIComponent(this.$window.atob(e)))},t.prototype.userCheck=function(){this.getToken()||this.$state.go("Login"),this.getToken()&&!this.status.branch&&this.$state.go("Register"),this.getToken()&&!this.status.verified&&this.$state.go("Pending")},t}();t.UserService=e,angular.module("app").service("UserService",e)}(e=t.Services||(t.Services={}))}(app||(app={}));var app;!function(t){var e;!function(t){var e=function(){function t(t,e){this.$http=t,this.$q=e}return t.$inject=["$http","$q"],t.prototype.yelpSearch=function(t){var e=(t.term,t.location,this.$q.defer());return e.promise},t}();t.YelpService=e,angular.module("app").service("YelpService",e)}(e=t.Services||(t.Services={}))}(app||(app={}));